{% extends 'base.html' %}
{% load static %}
{% block content %}
{% include 'navbar.html' %}
<style>
    body {
  padding: 10px;
  background-color: #A0B0AF;
}

.container-box {
  background-color: white;
  border: 1px solid #ccc;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  margin-bottom: 15px;
}

.title-box {
  background-color: white;
  border: 1px solid #ccc;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  margin: 20px auto;
  width: 90%;
  max-width: 600px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.search-container {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 70%;
}

#search-input {
  flex: 2;
  min-width: 500px;
  max-width: 100%;
}

#search-btn,
.btn-warning {
  flex-shrink: 0;
}

.filter-container {
  display: flex;
  align-items: center;
  margin-top: 10px;
  gap: 8px;
}

#filter-select {
  flex: 2;
  min-width: 200px;
}

.btn-info {
  flex-shrink: 0;
}

.btn {
  font-size: 0.9rem;
  padding: 5px 10px;
}

.table th, .table td {
  font-size: 0.9rem;
  padding: 8px;
}

.pagination-container {
  display: flex;
  justify-content: center; 
  align-items: center;
  margin-top: 10px;
  padding: 15px;
  background-color: #f8f9fa;
  border-radius: 8px;
}

.pagination {
  display: flex;
  list-style-type: none;
  padding: 0;
  margin: 0;
}

.page-item {
  margin: 0 5px;
}

.page-link {
  text-decoration: none;
  padding: 10px 15px;
  color: #007bff;
}

.page-link:hover {
  background-color: #f8f9fa;
  border-radius: 4px;
}

.bg-danger {
  background-color: #f3858e !important;
}
.bg-warning {
  background-color: #f8de88 !important;
}
.btn-danger[title],
.btn-warning[title] {
  cursor: pointer;
}

.table-product table{
  table-layout: fixed;
  width: 100%;
  font-size: 0.8rem;
}
.table-product th, .table-product td {
  word-wrap: break-word;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  padding: 8px;
}

</style>
<div class="content" style=" margin-left: 206px;  margin-top: 1;">
<div class="title-box d-flex justify-content-center">
  <h1>Lista de Usuarios</h1>
</div>
<div class="container">
    <div class="container-box">
        <div class="header">
            <div class="table-product">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th># ID</th>
                            <th>Nombre de Usuario</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th>Opciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td>{{ user.username }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.role }}</td>
                            <td>
                                <!-- Botón para abrir el modal de edición -->
                                <button type="button" class="btn btn-outline-dark btn-sm" data-bs-toggle="modal" data-bs-target="#editModal" data-user-id="{{ user.id }}">
                                    Editar
                                    <i class="fa-solid fa-pen-to-square" style="color: #000000;"></i>
                                </button>

                                <!-- Botón para abrir el modal de eliminación -->
                                <button type="button" class="btn btn-outline-dark btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal" data-user-id="{{ user.id }}">
                                    Eliminar
                                    <i class="fa-solid fa-trash" style="color: #000000;"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>
        <div class="mt-3 d-flex justify-content-center">
            <a href="{% url 'signup' %}" class="btn btn-secondary mb-3">
                Agregar Usuario
                <i class="fas fa-plus-circle"></i>
            </a>
        </div>
    </div>
  </div>
            

            
    


<!-- Modal para editar usuario -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Editar Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- El contenido del formulario de edición será cargado dinámicamente aquí -->
                <div id="modalEditFormContent"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para eliminar usuario -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Eliminar Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que deseas eliminar este usuario?</p>
            </div>
            <div class="modal-footer">
                <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="user_id" id="user-id">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascript %}
<script>
    // Cuando se abre el modal de editar
    var editModal = document.getElementById('editModal');
    editModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var userId = button.getAttribute('data-user-id');
        
        // Cargar el contenido del formulario de edición vía AJAX
        fetch("{% url 'edit_user' 0 %}".replace('0', userId))
            .then(response => response.text())
            .then(html => {
                document.getElementById('modalEditFormContent').innerHTML = html;
            });
    });

    // Cuando se abre el modal de eliminar
    var deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var userId = button.getAttribute('data-user-id');
        
        // Actualiza la acción del formulario con el ID correcto
        var form = document.getElementById('deleteForm');
        form.action = "{% url 'delete_user' 0 %}".replace('0', userId);
    });
</script>
{% endblock javascript %}
